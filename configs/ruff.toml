# =============================================================================
# RUFF CONFIGURATION FOR ODOO MODULES
# =============================================================================
# This file is copied to client repositories by solt-pre-commit
# Standalone ruff.toml for repos that prefer separate config files
# =============================================================================

# Base configuration
line-length = 120
target-version = "py310"

# Exclude directories
exclude = [
    ".bzr",
    ".direnv",
    ".eggs",
    ".git",
    ".git-rewrite",
    ".hg",
    ".mypy_cache",
    ".nox",
    ".pants.d",
    ".pytype",
    ".ruff_cache",
    ".svn",
    ".tox",
    ".venv",
    "__pypackages__",
    "_build",
    "buck-out",
    "build",
    "dist",
    "node_modules",
    "venv",
    # Odoo specific
    "static",
    "lib",
    "migrations",
    "__pycache__",
]

# Respect gitignore
respect-gitignore = true

[lint]
# Enable these rule sets
select = [
    "E", # pycodestyle errors
    "W", # pycodestyle warnings
    "F", # Pyflakes
    "I", # isort
    "N", # pep8-naming
    "B", # flake8-bugbear
    "C4", # flake8-comprehensions
    "UP", # pyupgrade
    "SIM", # flake8-simplify
    "RUF", # Ruff-specific rules
    "PTH", # flake8-use-pathlib
    "PL", # Pylint
    "TRY", # tryceratops
]

# Ignore these specific rules
ignore = [
    # Line length handled by formatter
    "E501",
    # Lambda assignment (common in Odoo for default values)
    "E731",
    # Function call in default argument (Odoo fields pattern)
    "B008",
    # Raise without from (common pattern in Odoo)
    "B904",
    # Naming conventions (Odoo has its own)
    "N802", # function name should be lowercase
    "N803", # argument name should be lowercase
    "N806", # variable in function should be lowercase
    "N815", # mixedCase variable in class scope
    "N999", # invalid module name

    # Simplify rules that reduce readability
    "SIM102", # nested if statements
    "SIM108", # ternary operator
    "SIM117", # multiple with statements

    # Type union syntax (need Python 3.10+)
    "UP007",
    # Mutable class attributes (Odoo fields are mutable)
    "RUF012",
    # Pylint rules that conflict with Odoo patterns
    "PLR0911", # too many return statements
    "PLR0912", # too many branches
    "PLR0913", # too many arguments
    "PLR0915", # too many statements
    "PLR2004", # magic value comparison
    "PLW0603", # global statement
    "PLW2901", # loop variable overwritten

    # Try/except rules
    "TRY003", # long exception message
    "TRY400", # logger.error instead of logger.exception
]

# Allow autofix for all enabled rules
fixable = ["ALL"]
unfixable = []

# Allow unused variables when underscore-prefixed
dummy-variable-rgx = "^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$"

[lint.per-file-ignores]
# Ignore unused imports in __init__.py
"__init__.py" = ["F401", "F403"]

# Ignore all rules in manifest files
"__manifest__.py" = ["ALL"]
"__openerp__.py" = ["ALL"]

# Relaxed rules for tests
"tests/**/*.py" = [
    "B011", # assert False
    "S101", # assert used
    "PLR2004", # magic values
    "ARG001", # unused function argument
    "ARG002", # unused method argument
]

# Relaxed rules for migrations
"migrations/**/*.py" = [
    "ALL",
]

[lint.isort]
# Known first-party modules (add your module names)
known-first-party = []

# Odoo as third-party
known-third-party = ["odoo", "odoo.addons"]

# Section order
section-order = [
    "future",
    "standard-library",
    "third-party",
    "first-party",
    "local-folder",
]

# Force single line imports
force-single-line = false

# Lines between sections
lines-after-imports = 2
lines-between-types = 1

[lint.mccabe]
# Maximum cyclomatic complexity
max-complexity = 15

[lint.flake8-bugbear]
# Extend immutable calls for Odoo field definitions
extend-immutable-calls = [
    "odoo.fields.Binary",
    "odoo.fields.Boolean",
    "odoo.fields.Char",
    "odoo.fields.Date",
    "odoo.fields.Datetime",
    "odoo.fields.Float",
    "odoo.fields.Html",
    "odoo.fields.Integer",
    "odoo.fields.Image",
    "odoo.fields.Json",
    "odoo.fields.Many2many",
    "odoo.fields.Many2one",
    "odoo.fields.Many2oneReference",
    "odoo.fields.Monetary",
    "odoo.fields.One2many",
    "odoo.fields.Properties",
    "odoo.fields.PropertiesDefinition",
    "odoo.fields.Reference",
    "odoo.fields.Selection",
    "odoo.fields.Text",
    "fields.Binary",
    "fields.Boolean",
    "fields.Char",
    "fields.Date",
    "fields.Datetime",
    "fields.Float",
    "fields.Html",
    "fields.Integer",
    "fields.Image",
    "fields.Json",
    "fields.Many2many",
    "fields.Many2one",
    "fields.Many2oneReference",
    "fields.Monetary",
    "fields.One2many",
    "fields.Properties",
    "fields.PropertiesDefinition",
    "fields.Reference",
    "fields.Selection",
    "fields.Text",
]

[lint.pylint]
# Maximum number of arguments for functions
max-args = 10

# Maximum number of statements in a function
max-statements = 60

# Maximum number of branches
max-branches = 15

# Maximum number of returns
max-returns = 10

# Maximum number of locals
max-locals = 20

[format]
# Use double quotes
quote-style = "double"

# Indent with spaces
indent-style = "space"

# Respect magic trailing commas
skip-magic-trailing-comma = false

# Unix-style line endings
line-ending = "lf"

# Format docstrings
docstring-code-format = true
docstring-code-line-length = 80